<% content_for :page_title, t(:page_titles, "Assessments")%>
<% if !can_do(@context.quizzes.new, @current_user, :create)%>
    <% @headers = false
       @show_left_side = false %>
    <% content_for :stylesheets do %>
        <style>
        #main{
            margin: 25px 200px !important;
        }
        </style>
    <% end %>

<% end %>
<% jammit_css :quizzes %>

<% if @context.feature_enabled?(:draft_state) %>

 <%# if Date.today.to_s.to_date.strftime('%Y%m%d') >= @context_enrollment.course_section.start_at.to_s.to_date.strftime('%Y%m%d') && Date.today.to_s.to_date.strftime('%Y%m%d') <= @context_enrollment.course_section.end_at.to_s.to_date.strftime('%Y%m%d') %>
            <% jammit_css :quizzes %>
            <% js_bundle :quizzes_index %>
            <%# else %>

            <!--<div class="content-box pad-box-mini border border-trbl border-round" style="margin: 100px auto;width: 50%;background: aliceblue;">-->
              <!--<h1>Assesments are unavaiable, please contact your administrator.</h1>-->
            <!--</div>-->
            <%# end %>


<%
  @body_classes << 'with_item_groups'

  js_env(:QUIZZES => {
    :assignment => @assignment_json,
    :open       => @open_json,
    :surveys    => @surveys_json,
    :options    => @quiz_options
  },
  :URLS => {
    :new_quiz_url       => context_url(@context, :new_context_quiz_url, :fresh => 1),
    :question_banks_url => context_url(@context, :context_question_banks_url)
  },
  :PERMISSIONS => {
    :create  => can_do(@context.quizzes.scoped.new, @current_user, :create),
    :manage  => can_do(@context, @current_user, :manage_assignments)
  },
  :FLAGS => {
    :question_banks => feature_enabled?(:question_banks)
  })
%>
<% else %>
<% js_bundle :quizzes_index_legacy  %>

<% content_for :right_side do %>
  <% if can_do(@context.quizzes.scoped.new, @current_user, :create) %>
    <div class="rs-margin-lr rs-margin-top">
      <%
        # Create New Quiz title
        cnq_title = t('links.create_new_quiz', "Create a New Assessment")
      %>
      <a href="<%= context_url(@context, :new_context_quiz_url, :fresh => 1) %>" class="btn button-sidebar-wide new-quiz-link"><i class="icon-add"><span class="screenreader-only"><%= cnq_title %></span></i> <%= cnq_title %></a>
      <% if can_do(@context, @current_user, :manage_assignments) && feature_enabled?(:question_banks) %>
        <%
          # Manage Question Banks title
          mqb_title = t('links.manage_question_banks', "Manage Question Banks")
        %>
        <a href="<%= context_url(@context, :context_question_banks_url) %>" class="btn button-sidebar-wide"><i class="icon-question"><span class="screenreader-only"><%= mqb_title %></span></i> <%= mqb_title %></a>
      <% end %>
      <% if can_do(@context, @current_user, :manage_assignments) && @unpublished_quizzes.length > 1 %>
        <a href="#" class="btn button-sidebar-wide publish_multiple_quizzes_link"><%= t('links.publish_multiple_quizzes', "Publish Multiple Assessments") %></a>
      <% end %>
    </div>
  <% end %>
<% end %>
<% content_for :stylesheets do %>
<style>
div.container-fluid
{
    padding-left: 217px;
    padding-top: 50px;
}
ul.quiz_list {
  margin-top: 5px;
  padding-left: 10px;
}
ul.quiz_list li.quiz {
  list-style-type: none;
  display: block;
  margin-bottom: 5px;
  padding: 5px;
  border: 1px solid #ccc;
}
ul.quiz_list li.quiz.unpublished {
  border-width: 2px;
}
ul.quiz_list li.quiz div.title {
  font-size: 1.2em;
  font-weight: bold;
}
ul.quiz_list li.quiz div.description {
  font-size: 0.85em;
  margin-left: 20px;
}
</style>
<% end %>
<% if can_do(@context, @current_user, :manage_assignments) && @unpublished_quizzes && !@unpublished_quizzes.empty? %>
        <div class="item-group-container" style="padding-bottom: 0px;">
          <div class="item-group-condensed">

            <h2 class="ig-header"><i class="icon-mini-arrow-down"></i><%= t('headers.unpublished_quizzes', "Unpublished Assessments") %></h2>
  <ul class="ig-list" id="unpublished_quizzes">
    <%= render :partial => "quiz_summary", :collection => @unpublished_quizzes, :locals => {:unpublished => true} %>
  </ul>
  <div title="<%= t('headers.publish_multiple_quizzes', "Publish Multiple Assessments") %>" id="publish_multiple_quizzes_dialog" style="display: none;">
    <%= form_tag context_url(@context, :context_quizzes_publish_url), :id => "publish_quizzes_form" do %>
      <%= before_label(:publish_multiple_quizzes, "Select the assessments you would like to publish at this time") %>
      <ul class="quiz_list unstyled_list">
        <li class="quiz_item blank" style="display: none;">
          <input type="checkbox" value="1" name="quizzes[]" class="id"/>
          <label class="title">&nbsp;</label>
        </li>
      </ul>
      <div class="button-container">
        <button type="submit" class="btn submit_button"><%= t('buttons.publish_quizzes', "Publish Assessments") %></button>
        <button type="button" class="btn btn button-secondary cancel_button"><%= t('#buttons.cancel', "Cancel") %></button>
      </div>
    <% end %>
  </div>
              </div>
            </div>
<% end %>
    <div class="item-group-container" style="padding-bottom: 70px;">
      <div class="item-group-condensed">
    <% if @assignment_quizzes.empty? && @open_quizzes.empty? %>
        <h2 class="ig-header">
          <!--<i class="icon-mini-arrow-down"></i>-->
<%= t('headers.course_quizzes', "Project Assessments") %></h2>
          <ul class="ig-list">
            <li>
              <div class="ig-row ig-row-empty">
                <div class="ig-empty-msg">
                  <%= t(:no_quizzes, "No assessments available") %>
                </div>
              </div>
            </li>
          </ul>

<% end %>
<% if !@assignment_quizzes.empty? %>
            <h2 class="ig-header" style="text-align: center;">
              <!--<i class="icon-mini-arrow-down"></i>-->
              <%= t('headers.assignment_quizzes', "Project Assessments") %></h2>
    <ul class="ig-list">

    <%= render :partial => "quiz_summary", :collection => @assignment_quizzes %>
  </ul>
<% end %>
<% if !@open_quizzes.empty? %>
            <h2 class="ig-header"><i class="icon-mini-arrow-down"></i><%= t('headers.practice_quizzes', "Practice Assessments") %></h2>
            <ul class="ig-list">
    <%= render :partial => "quiz_summary", :collection => @open_quizzes %>
  </ul>
<% end %>
<% if !@surveys.empty? %>
            <h2 class="ig-header"><i class="icon-mini-arrow-down"></i><%= t('headers.surveys', "Surveys") %></h2>
            <ul class="ig-list">
    <%= render :partial => "quiz_summary", :collection => @surveys %>
  </ul>
<% end %>

<% if (@quizzes.any?{|q| q.lock_at || q.unlock_at} || @context.try_rescue(:module_based?)) && !can_do(@context, @current_user, :manage_content) %>
  <a href="<%= context_url(@context, :context_locks_url) %>" id="quiz_locks_url" style="display: none;">&nbsp;</a>
  <%= image_tag "lock_small.png", :style => "display: none;", :class => "content_lock_icon", :id => "quiz_lock_icon", :title => t('titles.this_quiz_is_locked', "This assessment is currently locked.  Click for more details."), :alt => "locked" %>
  <!--<a href="<%#= context_url(@context, :context_context_modules_url) %>" id="context_modules_url" style="display: none;">&nbsp;</a>-->
<% end %>
<div id="send_invitations">

</div>
    </div>
    </div>
<% end %>
<%-
  @body_classes ||= []
  keyboard_navigation = yield :keyboard_navigation
  left_side = nil
  left_side_custom = nil
  right_side = yield :right_side
  wizard = yield :wizard_box
  top_nav = yield :top_nav

  content_for :pre_html do
    @body_class_no_headers = @headers == false
    @show_embedded_chat = embedded_chat_visible
    @show_fixed_bottom = (@fixed_warnings.present? || (@real_current_user && @real_current_user != @current_user)) && (!@body_class_no_headers || @outer_frame)
    @body_classes << "no-headers" if @body_class_no_headers
    unless (@body_classes.include? "no-headers") || (@show_left_side == false)
      left_side = yield :left_side
      left_side_custom = yield :left_side_custom
      @show_left_side ||= (section_tabs.length > 0 || left_side_custom.try(:length))
    end
    @body_classes << "with-left-side" if @show_left_side
    #we dont want to render a right side unless there is actually content in it.
    @body_classes << "with-right-side" if right_side and not right_side.strip.empty?
    @body_classes << "padless-content" if @padless
    @body_classes << "with-embedded-chat" if @show_embedded_chat
    @body_classes << 'with-fixed-bottom' if @show_fixed_bottom
    @body_classes << 'pages' if @controller.js_env[:WIKI_PAGE].present?
    @body_classes << @active_tab
  end

-%>
 <style>
     html.mm-opened .mm-page,
     html.mm-opened #mm-blocker,
     html.mm-opened .mm-fixed-top,
     html.mm-opened .mm-fixed-bottom,
     html.mm-opened .mm-menu.mm-horizontal > .mm-panel {
         -webkit-transition: none 0.4s ease;
         -moz-transition: none 0.4s ease;
         -ms-transition: none 0.4s ease;
         -o-transition: none 0.4s ease;
         transition: none 0.4s ease;
         -webkit-transition-property: top, right, bottom, left, border;
         -moz-transition-property: top, right, bottom, left, border;
         -ms-transition-property: top, right, bottom, left, border;
         -o-transition-property: top, right, bottom, left, border;
         transition-property: top, right, bottom, left, border; }
     html.mm-opened .mm-page,
     html.mm-opened #mm-blocker {
         left: 0%;
         top: 0;
         margin: 0;
         border: 0px solid rgba(0, 0, 0, 0); }
     html.mm-opened.mm-opening .mm-page,
     html.mm-opened.mm-opening #mm-blocker {
         border: 0px solid rgba(100, 100, 100, 0); }

     .mm-menu .mm-hidden {
         display: none; }

     .mm-fixed-top,
     .mm-fixed-bottom {
         position: fixed;
         left: 0; }

     .mm-fixed-top {
         top: 0; }

     .mm-fixed-bottom {
         bottom: 0; }

     html.mm-opened .mm-page,
     .mm-menu > .mm-panel {
         -webkit-box-sizing: border-box;
         -moz-box-sizing: border-box;
         -ms-box-sizing: border-box;
         -o-box-sizing: border-box;
         box-sizing: border-box; }

     html.mm-opened,
     html.mm-opened body {
         width: 100%;
         height: 100%;
         overflow: hidden;
         position: relative; }

     html.mm-opened .mm-page {
         height: 100%;
         overflow: hidden;
         position: absolute; }

     html.mm-background .mm-page {
         background: inherit; }

     #mm-blocker {
         background: #fff;
         opacity: 0;
         display: none;
         width: 100%;
         height: 100%;
         position: absolute;
         z-index: 999999; }

     html.mm-opened #mm-blocker,
     html.mm-blocking #mm-blocker {
         display: block; }

     .mm-menu.mm-current {
         display: block; }

     .mm-menu {
         background: inherit;
         display: none;
         overflow: hidden;
         height: 100%;
         padding: 0;
         position: absolute;
         left: 0;
         top: 0;
         z-index: 0; }
     .mm-menu > .mm-panel {
         background: inherit;
         -webkit-overflow-scrolling: touch;
         overflow: scroll;
         overflow-x: hidden;
         overflow-y: auto;
         width: 100%;
         height: 100%;
         padding: 20px;
         position: absolute;
         top: 0;
         left: 100%;
         z-index: 0; }
     .mm-menu > .mm-panel.mm-opened {
         left: 0%; }
     .mm-menu > .mm-panel.mm-subopened {
         left: -40%; }
     .mm-menu > .mm-panel.mm-highest {
         z-index: 1; }
     .mm-menu > .mm-panel.mm-hidden {
         display: block;
         visibility: hidden; }

     .mm-menu .mm-list {
         padding: 20px 0; }
     .mm-menu > .mm-list {
         padding: 20px 0 40px 0; }

     .mm-panel > .mm-list {
         margin-left: -20px;
         margin-right: -20px; }
     .mm-panel > .mm-list:first-child {
         padding-top: 0; }

     .mm-list,
     .mm-list > li {
         list-style: none;
         display: block;
         padding: 0;
         margin: 0; }

     .mm-list {
         font: inherit;
         font-size: 14px; }
     .mm-list a,
     .mm-list a:hover {
         text-decoration: none; }
     .mm-list > li {
         position: relative; }
     .mm-list > li > a,
     .mm-list > li > span {
         text-overflow: ellipsis;
         white-space: nowrap;
         overflow: hidden;
         color: inherit;
         line-height: 20px;
         display: block;
         padding: 10px 10px 10px 20px;
         margin: 0; }
     .mm-list > li:not(.mm-subtitle):not(.mm-label):not(.mm-noresults)::after {
         content: '';
         border-bottom-width: 1px;
         border-bottom-style: solid;
         display: block;
         width: 100%;
         position: absolute;
         bottom: 0;
         left: 0; }
     .mm-list > li:not(.mm-subtitle):not(.mm-label):not(.mm-noresults):after {
         width: auto;
         margin-left: 20px;
         position: relative;
         left: auto; }
     .mm-list a.mm-subopen {
         width: 40px;
         height: 100%;
         padding: 0;
         position: absolute;
         right: 0;
         top: 0;
         z-index: 2; }
     .mm-list a.mm-subopen::before {
         content: '';
         border-left-width: 1px;
         border-left-style: solid;
         display: block;
         height: 100%;
         position: absolute;
         left: 0;
         top: 0; }
     .mm-list a.mm-subopen.mm-fullsubopen {
         width: 100%; }
     .mm-list a.mm-subopen.mm-fullsubopen:before {
         border-left: none; }
     .mm-list a.mm-subopen + a,
     .mm-list a.mm-subopen + span {
         padding-right: 5px;
         margin-right: 40px; }
     .mm-list > li.mm-selected > a.mm-subopen {
         background: transparent; }
     .mm-list > li.mm-selected > a.mm-fullsubopen + a,
     .mm-list > li.mm-selected > a.mm-fullsubopen + span {
         padding-right: 45px;
         margin-right: 0; }
     .mm-list a.mm-subclose {
         text-indent: 20px;
         padding-top: 30px;
         margin-top: -20px; }
     .mm-list > li.mm-label {
         text-overflow: ellipsis;
         white-space: nowrap;
         overflow: hidden;
         font-size: 10px;
         text-transform: uppercase;
         text-indent: 20px;
         line-height: 25px;
         padding-right: 5px; }
     .mm-list > li.mm-spacer {
         padding-top: 40px; }
     .mm-list > li.mm-spacer.mm-label {
         padding-top: 25px; }
     .mm-list a.mm-subopen:after,
     .mm-list a.mm-subclose:before {
         content: '';
         border: 2px solid transparent;
         display: block;
         width: 7px;
         height: 7px;
         margin-bottom: -5px;
         position: absolute;
         bottom: 50%;
         -webkit-transform: rotate(-45deg);
         -moz-transform: rotate(-45deg);
         -ms-transform: rotate(-45deg);
         -o-transform: rotate(-45deg);
         transform: rotate(-45deg); }
     .mm-list a.mm-subopen:after {
         border-top: none;
         border-left: none;
         right: 18px; }
     .mm-list a.mm-subclose:before {
         border-right: none;
         border-bottom: none;
         margin-bottom: -15px;
         left: 22px; }

     .mm-menu.mm-vertical .mm-list .mm-panel {
         display: none;
         padding: 10px 0 10px 10px; }
     .mm-menu.mm-vertical .mm-list .mm-panel li:last-child:after {
         border-color: transparent; }
     .mm-menu.mm-vertical .mm-list li.mm-opened > .mm-panel {
         display: block; }
     .mm-menu.mm-vertical .mm-list > li.mm-opened > a.mm-subopen {
         height: 40px; }
     .mm-menu.mm-vertical .mm-list > li.mm-opened > a.mm-subopen:after {
         -webkit-transform: rotate(45deg);
         -moz-transform: rotate(45deg);
         -ms-transform: rotate(45deg);
         -o-transform: rotate(45deg);
         transform: rotate(45deg);
         top: 16px;
         right: 16px; }

     html.mm-opened .mm-page {
         box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); }
     .mm-menu {
         color: rgba(255, 255, 255, 0.6); }
     .mm-menu .mm-list > li:after {
         border-color: rgba(0, 0, 0, 0.15); }
     .mm-menu .mm-list > li > a.mm-subclose {
         background: rgba(0, 0, 0, 0.1);
         color: rgba(255, 255, 255, 0.3); }
     .mm-menu .mm-list > li > a.mm-subopen:after, .mm-menu .mm-list > li > a.mm-subclose:before {
         border-color: rgba(255, 255, 255, 0.3); }
     .mm-menu .mm-list > li > a.mm-subopen:before {
         border-color: rgba(0, 0, 0, 0.15); }
     .mm-menu .mm-list > li.mm-selected > a:not(.mm-subopen),
     .mm-menu .mm-list > li.mm-selected > span {
         background: rgba(0, 0, 0, 0.1); }
     .mm-menu .mm-list > li.mm-label {
         background: rgba(255, 255, 255, 0.05); }
     .mm-menu.mm-vertical .mm-list li.mm-opened > a.mm-subopen,
     .mm-menu.mm-vertical .mm-list li.mm-opened > ul {
         background: rgba(255, 255, 255, 0.05); }

     html.mm-opened.mm-opening .mm-page,
     html.mm-opened.mm-opening #mm-blocker,
     html.mm-opened.mm-opening .mm-fixed-top,
     html.mm-opened.mm-opening .mm-fixed-bottom {
         left: 80%; }

     .mm-menu {
         width: 80%; }

     @media all and (max-width: 175px) {
         .mm-menu {
             width: 140px; }

         html.mm-opened.mm-opening .mm-page,
         html.mm-opened.mm-opening #mm-blocker,
         html.mm-opened.mm-opening .mm-fixed-top,
         html.mm-opened.mm-opening .mm-fixed-bottom {
             left: 140px; } }
     @media all and (min-width: 550px) {
         .mm-menu {
             width: 440px; }

         html.mm-opened.mm-opening .mm-page,
         html.mm-opened.mm-opening #mm-blocker,
         html.mm-opened.mm-opening .mm-fixed-top,
         html.mm-opened.mm-opening .mm-fixed-bottom {
             left: 440px; } }
     html.mm-nooverflowscrolling.mm-opened {
         height: auto;
         overflow: auto;
         overflow-x: hidden;
         overflow-y: scroll; }
     html.mm-nooverflowscrolling.mm-opened body {
         overflow: auto; }
     html.mm-nooverflowscrolling.mm-opened .mm-page {
         min-height: 1000px;
         position: fixed; }
     html.mm-nooverflowscrolling.mm-opened .mm-menu {
         height: auto;
         min-height: 1000px;
         overflow: auto;
         overflow-x: hidden;
         position: relative;
         left: auto;
         top: auto; }
     html.mm-nooverflowscrolling.mm-opened > .mm-panel {
         position: relative;
         height: auto;
         display: none;
         left: 0; }
     html.mm-nooverflowscrolling.mm-opened > .mm-panel.mm-current {
         display: block; }


 </style>

<% content_for :head do %>
  <%= include_common_stylesheets %>
  <% if @eportfolio_view === true %>
    <%= stylesheet_link_tag "compiled/instructure_eportfolio.css" %>
  <% end %>
<% end %>
<%= render :partial => "layouts/head" %>
<%= render :partial => 'shared/flash_notices' %>

<div id="header" class="no-print <%= 'no-user' unless @current_user %>">
  <div id="header-inner">
    <a href="#content" id="skip_navigation_link"><%= t 'links.skip_to_content', "Skip To Content" %></a>
    <a id="header-logo" href="<%= root_url %>"><%= t 'links.dashboard', "My Dashboard" %></a>
    <b id="header-logo-secondary"></b>
    <!--<div id="topbar">-->
      <!--<%# if (identity = yield :identity) %>-->
        <!--<%#= identity %>-->
      <!--<%# else %>-->
        <!--<%#- cache_if(!@real_current_user, [@current_user || 'nobody', 'identity-15m'], :expires_in => 15.minutes) do -%>-->
          <!--<%#= render(:partial => 'shared/identity') %>-->
        <!--<%#- end -%>-->
      <!--<%# end %>-->
    <!--</div>-->
    <%= render(:partial => "shared/keyboard_navigation_hint") if keyboard_navigation %>

    <% if @current_user %>
        <ul role="navigation" id="menu" aria-label="<%= t('navigation.main', 'Main Navigation') %>">

      <%- cache([@current_user, 'home-menu-15m'], :expires_in => 15.minutes) do -%>
      <li id="courses_menu_item" class="menu-item">
        <%- if show_home_menu? -%>
          <%= render(:partial => 'shared/home_menu') %>
        <%- else  -%>
          <a href="<%= dashboard_path %>" class="menu-item-no-drop"><%= t 'links.home', 'Home' %></a>
        <%- end -%>
      </li>
      <%- end -%>
      <li id="courses_menu_item" class="menu-item">
        <%- if show_home_menu? -%>
            <%= render(:partial => 'shared/home_menu1') %>
        <%- else  -%>
            <a href="<%= dashboard_path %>" class="menu-item-no-drop"><%= t 'links.home', 'Home' %></a>
        <%- end -%>
      </li>
      <li id="assignments_menu_item" class="menu-item">
      <%
      # this will cache the assignments menu for 3 minutes.  the way it is right now it does 3 really expensive queries every page load.
      # to do this better we would either figure a better way to find needing_submitting, needing_grading, and recently_graded
      # or use delayed_job and memcache together to compute and cache it outside of the scope of a request
      # so by just caching this stupidly for 3 minutes, if there is a new thing that should show up in the last 3 minutes, it wont show up.
      cache([@current_user, 'assignments_menu'], :expires_in => 3.minutes) do %>
        <%# if there is anything inside the assignments drop down %>
      <%-
        max_to_show = 8
        assignment_sets = {
          :assignments_needing_submitting => t('menu.assignments_needing_submitting', "To Turn In"),
          :assignments_needing_grading    => t('menu.assignments_needing_grading', "To Grade"),
          :assignments_recently_graded    => t('menu.assignments_recently_graded', "Recently Graded")
        }
        total_shown = 0
        if assignment_sets.any?{ |k, v| @current_user.send(k).length > 0 }
      -%>
        <a href="/assignments" class="menu-item-title"><%= t('menu.assignments', 'Assignments') %><span class="menu-item-title-icon"></span> <i class="icon-mini-arrow-down"></i></a>
        <div class="menu-item-drop">
          <table cellspacing="0">
            <tr>
              <% assignment_sets.each do |k,v|
                  if (set = @current_user.send(k)).length > 0
                    set = set[0,(max_to_show - total_shown)]
                    total_shown += set.length
                   %><%= render(:partial => "shared/menu_section", :locals => {
                                :max_to_show => max_to_show,
                                #:more_link_for_over_max => assignments_path,
                                :collection => set,
                                :collection_size => total_shown >= max_to_show ? @current_user.send(k, limit: nil).size : set.length,
                                :partial => "shared/menu_assignment",
                                :key => k,
                                :title => v })  %>
                  <%
                  end
                end
              %>
            </tr>
          </table>
        </div>
        <%- else #there is not anything to show in the assignments drop down  -%>
        <!--<a href="/assignments" class="menu-item-no-drop"><%#= t('menu.assignments', 'Assignments') %></a>-->
        <%- end -%>
      <% end %>
      </li>
      <% if !!@domain_root_account.Sublime_grade_disable? && !@domain_root_account.Sublime_show_lock_menu?  %>
      <li id="grades_menu_item" class="menu-item">
        <%= link_to(t('menu.grades', 'Grades'), :grades, :class=>"menu-item-no-drop") %>
      </li>
      <% end  %>
      <li id="calendar_menu_item" class="menu-item">
        <!--<a href="<%#= calendar_path %>" class="menu-item-no-drop"><%#= t('menu.calendar', 'Calendar') %></a>-->
      </li>
          <li class="menu-item" style="float: right;margin-right:30px;">
            <a href="#" class="menu-item-title">
              <%= @current_user.name %>
              <span class="menu-item-title-icon"></span> <i class="icon-mini-arrow-down"></i></a>
            <div class="menu-item-drop" style="width: 136px;">
              <table cellspacing="0">
                <tr>
                  <td class="menu-item-drop-column" id="menu_enrollments">
  <span class="menu-item-heading">

  </span>

                    <ul class="menu-item-drop-column-list">
                      <li class="customListItem"><%= link_to t('links.settings', "Settings"), settings_profile_path %></li>
                      <li class="logout customListItem"><%= link_to t('links.logout', "Logout"), logout_path, :method => :delete %></li>
                    </ul>
                  </td>
                </tr>
              </table>
            </div>

          </li>
    </ul>
    <% end %>
  </div>
</div>
<div id="instructure_ajax_error_box">
  <div style="text-align: right; background-color: #fff;"><a href="#" class="close_instructure_ajax_error_box_link"><%= t('links.close', 'Close') %></a></div>
  <iframe id="instructure_ajax_error_result" src="about:blank" style="border: 0;"></iframe>
</div>

<%= yield :leading_content %>

<div id="wrapper-container">
  <div id="wrapper">
    <% if @show_left_side %>
      <%# @left_side_list_view is temporary until we redo eportfolios %>
        <div id="menu1">
      <div id="left-side" class="<% if !@no_left_side_list_view %>list-view<% end %>">
      <% if left_side %>
        <%= left_side %>
      <% else %>
        <% if @context.try(:short_name) %>
          <div class='h1' id="section-tabs-header">
            <%= @context.short_name %>
            <% if @context && @context.respond_to?(:context)  %>
              <a href="<%= url_for(@context.context) %>" id="section-tabs-header-subtitle" class="ellipsis"><%= @context.context.name %></a>
            <% elsif @context && @context.respond_to?(:enrollment_term) && !@context.enrollment_term.default_term? %>
              <span id="section-tabs-header-subtitle" class="ellipsis"><%= @context.enrollment_term.name %></span>
            <% end %>

                 </div>

        <% end %>
        <%= section_tabs %>
      <% end %>
      <% if left_side_custom %>
        <%= left_side_custom %>
      <% end %>
    </div>
        </div>
    <% end %>
    <div id="main">
      <a href="#menu1"><i class="icon icon-outdent"></i></a>
      <div id="right-side-wrapper">
        <aside id="right-side" role="complementary">
          <%= right_side %>
        </aside>
      </div>
      <div id="not_right_side">
        <div id="content-wrapper">
          <%= render_crumbs %>
          <div id="content" role="main" class="container-fluid">
            <%= yield %>
          </div>
        </div>
      </div>
    </div>
    <footer role="contentinfo" id="footer">
      <span id="footer-links">
        <% if Setting.get_cached("show_opensource_linkback", "false") == "true" %>
        <% end %>
        <%= help_link %>
        <%= render :partial => 'shared/footer_links' %>
      </span>
    </footer>
  </div>
</div>

<% if @show_embedded_chat %>
  <%= render :partial => 'shared/embedded_chat' %>
<% end %>

<% if @show_fixed_bottom %>
  <%= render :partial => 'layouts/fixed_bottom' %>
<% end %>

<% if wizard %>
  <div id="wizard_spacer_box"></div>
  <div id="wizard_box" role="dialog" tabindex="-1">
    <div class="shadow shadow_1"></div>
    <div class="shadow shadow_3"></div>
    <div class="shadow shadow_5"></div>
    <div class="wizard_content">
      <div class="links">
        <a href="#" class="close_wizard_link"><i class="icon-x"></i><span class="screen-reader-text"><%= t('links.close', 'Close') %></span></a>
      </div>
      <%= wizard %>
    </div>
  </div>
<% end %>
<% if keyboard_navigation %>
  <div id="keyboard_navigation">
    <%= keyboard_navigation %>
    <div class='hidden-readable' tabindex='0'>
      <%= t('keyboard_navigation.close', 'Press comma to close this dialog') %>
   </div>
  </div>
<% end %>
  <div style="display:none;"><!-- Everything inside of this should always stay hidden -->
    <div id="ajax_authenticity_token"><%= form_authenticity_token %></div>
    <div id="time_zone_offset"><%= ActiveSupport::TimeWithZone.new(Time.now.utc, Time.zone).utc_offset / -60 %></div>
    <% if @context && session && temp_type = session["role_#{@context.asset_string}"] %>
      <span id="switched_role_type" class="<%= @context.asset_string %>" data-role="<%= temp_type %>"><%= Enrollment.readable_type(temp_type) %></span>
    <% end %>
    <% if @page_view %>
      <a href="<%= page_view_path(@page_view.id || @page_view.temporary_id) %>" id="page_view_update_path">&nbsp;</a>
      <div id="page_view_id"><%= @page_view.id || @page_view.temporary_id %></div>
    <% end %>
    <div id="domain_root_account_id"><%= @domain_root_account.try(:id) %></div>
    <% if equella_enabled? %>
      <a id="equella_endpoint_url" href="<%= @equella_settings.endpoint %>">&nbsp;</a>
      <a id="equella_callback_url" href="<%= external_content_success_url('equella') %>">&nbsp;</a>
      <a id="equella_cancel_url" href="<%= external_content_cancel_url('equella') %>">&nbsp;</a>
      <a id="equella_action" href="<%= @equella_settings.default_action %>">&nbsp;</a>
      <% if @equella_settings.teaser %>
        <div id="equella_teaser"><%= @equella_settings.teaser %></div>
      <% end %>
    <% end %>
  </div>
<% cache('global_dialogs_render') do %>
  <%= render :partial => "shared/global_dialogs" %>
<% end %>
<div id='aria_alerts' class='hide-text affix' role="alert" aria-live="assertive"></div>
<%= debug(params) if Rails.env.development? %>
<%= render :partial => 'accounts/demo_bottom', :locals => { :include_common_bundle => true } %>
<%= render :partial => 'layouts/foot', :locals => { :include_common_bundle => true } %>

